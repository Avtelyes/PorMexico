<%= render 'application/navigation' %>
<div style="margin-top:100px;"></div>
<% @posts.each do |post| %>
  <div class="post-container">
    <div class="post">
      <h4 class="center hour"><%= post.created_at.in_time_zone(-5).strftime("%b %e, %l:%M %p") %></h4>
      <div class="image-container">
        <%= image_tag(post.user.picture) %>
      </div>
      <div class="post-info">
        <h3><%= post.user.name %></h3>
        <p>
           <% if post.category == "0"%>
              <span class="red">
                Necesito ayuda
              </span>
          <% elsif post.category =="1"%>
              <span class="green">
                Quiero ayudar
              </span>
          <% end %>
           con
          <%= post.requirements.find_each do |req| %>
              <span class="underline"><%= req.name %></span>,
          <% end %>
          en <i class="fa fa-map-marker" aria-hidden="true"></i> <b><%= post.location.address %></b><hr style="border-color:#000"> <%= post.content %><br/></p>
      </div>
      <% if post.category == "0"%>
          <span>Ayudado por: <%=post.helping_users.count %> persona(s)</span>
    <% end %>
    </div>
    <div class="my-button-container">
      <% if post.category == "1" %>
        <% if post.user.id == current_user&.id %>
            <%= button_to("Borrar", delete_post_path(id: post), method: :post, class:"my-button b-red") %>
        <% elsif  post.category == "1" %>
            <%= button_to("Solicitar", help_post_path(id: post), method: :post, class: "my-button b-red", :remote => true, 'data-toggle' =>  "modal", 'data-target' => '#modal-window' ) %>
              <div id="modal-request" class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel">
                <div class="modal-dialog modal-lg" role="document">
                  <div class="modal-content">
                    <div class="modal-header">
                      <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                      <h4 class="modal-title" id="myModalLabel" style="text-align: center">Ayudar</h4>
                    </div>
                    <div class="modal-body row">
                      <div class="col-sm-4">
                        Whatsapp
                        <a href="https://api.whatsapp.com/send?phone=521<%= post.phone %>" target="_blank">
                          <img class="img-responsive" src="images/whatsapp.png">
                        </a>
                      </div>
                      <div class="col-sm-4">
                        Facebook
                        <a href="https://<%= post.user.fb_profile %>" target="_blank">
                          <img class="img-responsive" src="images/facebook.png">
                        </a>
                      </div>
                      <div class="col-sm-4">
                        Teléfono
                        <a href="tel:52<%= post.phone %>">
                          <img class="img-responsive" src="images/phone.png">
                        </a>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
        <% end %>
      <% else %>
        <% if post.user.id == current_user&.id %>
            <%= button_to("Borrar", delete_post_path(id: post), method: :post, class:"my-button b-red") %>
        <% elsif post.category == "0" %>
            <% if post.helping_users.where(id: current_user&.id).empty? %>
              <%= button_to("Ayudar", help_post_path(id: post), id:"help", method: :post, class: "my-button b-green", :remote => true, 'data-toggle' =>  "modal", 'data-target' => '#modal-window' ) %>
              <div id="modal-window" class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel">
                <div class="modal-dialog modal-lg" role="document">
                  <div class="modal-content">
                    <div class="modal-header">
                      <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                      <h4 class="modal-title" id="myModalLabel" style="text-align: center">Ayudar</h4>
                    </div>
                    <div class="modal-body row">
                      <div class="col-sm-4">
                        Whatsapp
                        <a href="https://api.whatsapp.com/send?phone=521<%= post.phone %>" target="_blank">
                          <img class="img-responsive" src="images/whatsapp.png">
                        </a>
                      </div>
                      <div class="col-sm-4">
                        Facebook
                        <a href="https://<%= post.user.fb_profile %>" target="_blank">
                          <img class="img-responsive" src="images/facebook.png">
                        </a>
                      </div>
                      <div class="col-sm-4">
                        Teléfono
                        <a href="tel:52<%= post.phone %>">
                          <img class="img-responsive" src="images/phone.png">
                        </a>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <% else %>
                  <%= button_to("Cancelar", cancel_help_post_path(id: post), method: :post, class: "my-button b-red", :remote => true ) %>
            <% end %>
        <% end %>
      <% end %>
    </div>
  </div>
<% end %>

<script>

</script>



